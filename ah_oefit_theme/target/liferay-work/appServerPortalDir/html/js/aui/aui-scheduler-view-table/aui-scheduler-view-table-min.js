YUI.add("aui-scheduler-view-table",function(e,t){var n=e.Lang,r=n.isFunction,i=n.isString,s=e.DataType.DateMath,o=e.WidgetStdMod,u=s.WEEK_LENGTH,a="-",f=".",l="",c=" ",h="scheduler-view",p="scheduler-view-table",d=function(e,t){return function(n){var r=n.all(e);return r.size()>=t?r:null}},v="body",m="boundingBox",g="close",y="col",b="colHeaderDaysNode",w="colgrid",E="colspan",S="columnDayHeader",x="columnTableGrid",T="container",N="content",C="data",k="day",L="displayDaysInterval",A="displayRows",O="div",M="down",_="endDate",D="event",P="events",H="eventsOverlay",B="filterFn",j="first",F="firstDayOfWeek",I="grid",q="header",R="headerDateFormatter",U="headerTableNode",z="icon",W="left",X="locale",V="more",$="next",J="node",K="overlay",Q="right",G="row",Y="rowsContainerNode",Z="scheduler",et="scheduler-event",tt="show",V="more",nt="startDate",rt="strings",it="table",st="tableGridNode",ot="tableRowContainer",ut="tableRows",at="tbody",ft="title",lt="tl",ct="today",ht="todayDate",pt="tr",dt="viewDate",vt="visible",mt=e.getClassName,gt=mt(z),yt=mt(z,"arrowstop-1-l"),bt=mt(z,"arrowstop-1-r"),wt=mt(h,it,w),Et=mt(h,it,w,j),St=mt(h,it,w,ct),xt=mt(h,it,T),Tt=mt(h,it,P,K,J),Nt=mt(h,it,P,K,J,v),Ct=mt(h,it,P,K,J,g),kt=mt(h,it,q,y),Lt=mt(h,it,q,k),At=mt(h,it,q,it),Ot=mt(h,it,V),Mt=mt(h,it,G),_t=mt(h,it,G,T),Dt=mt(h,it,C),Pt=mt(h,it,C,y),Ht=mt(h,it,C,y,ft),Bt=mt(h,it,C,y,ft,M),jt=mt(h,it,C,y,ft,j),Ft=mt(h,it,C,y,ft,$),It=mt(h,it,C,y,ft,ct),qt=mt(h,it,C,D),Rt=mt(h,it,C,D,W),Ut=mt(h,it,C,D,Q),zt=mt(h,it,C,j),Wt=mt(h,it,I),Xt=mt(h,it,I,j),Vt='<div class="'+xt+'">'+'<div class="'+_t+'"></div>'+"</div>",$t='<div class="'+Tt+'">'+'<div class="'+Nt+'"></div>'+'<a href="javascript:;" class="'+Ct+'">{label}</a>'+"</div>",Jt='<td class="'+wt+'">&nbsp;</td>',Kt='<th class="'+Lt+'"><div>&nbsp;</div></th>',Qt='<table cellspacing="0" cellpadding="0" class="'+At+'">'+"<tbody>"+'<tr class="'+kt+'"></tr>'+"</tbody>"+"</table>",Gt='<a href="javascript:;" class="'+Ot+'">{labelPrefix} {count} {labelSuffix}</a>',Yt='<div class="'+Mt+'" style="top: {top}%; height: {height}%;"></div>',Zt='<table cellspacing="0" cellpadding="0" class="'+Dt+'">'+"<tbody></tbody>"+"</table>",en='<table cellspacing="0" cellpadding="0" class="'+Wt+'">'+"<tbody>"+"<tr></tr>"+"</tbody>"+"</table>",tn='<span class="'+[gt,yt].join(c)+'"></span>',nn='<span class="'+[gt,bt].join(c)+'"></span>',rn='<td class="'+Pt+'"><div></div></td>',sn="<tr></tr>",on=e.Component.create({NAME:p,ATTRS:{bodyContent:{value:l},displayDaysInterval:{value:42},displayRows:{value:3},fixedHeight:{value:!0},name:{value:it},headerDateFormatter:{value:function(t){var n=this,r=n.get(Z);return e.DataType.Date.format(t,{format:"%A",locale:r.get(X)})},validator:i},navigationDateFormatter:{value:function(t){var n=this,r=n.get(Z);return e.DataType.Date.format(t,{format:"%b %Y",locale:r.get(X)})},validator:r},scrollable:{value:!1},strings:{value:{close:"Close",show:"Show",more:"more"}},headerTableNode:{valueFn:function(){return e.Node.create(Qt)}},colHeaderDaysNode:{valueFn:"_valueColHeaderDaysNode"},rowsContainerNode:{valueFn:function(){return e.Node.create(Vt)}},tableGridNode:{valueFn:"_valueTableGridNode"}},HTML_PARSER:{colHeaderDaysNode:d(f+Lt,7),headerTableNode:f+At,rowsContainerNode:f+xt,tableGridNode:d(f+Wt,7)},EXTENDS:e.SchedulerView,prototype:{evtDateStack:null,evtRenderedStack:null,rowDataTableStack:null,initializer:function(){var t=this;t.evtDateStack={},t.evtRenderedStack={},t.rowDataTableStack={},t[b]=t.get(b),t[U]=t.get(U),t[Y]=t.get(Y),t[st]=t.get(st),t[S]=t.headerTableNode.one(f+kt),t[x]=e.NodeList.create(),t[ot]=t[Y].one(f+_t),t[ut]=e.NodeList.create()},bindUI:function(){var t=this;t[Y].delegate("click",e.bind(t._onClickMore,t),f+Ot)},renderUI:function(){var e=this,t=e._getDisplayRowsCount(),n;for(n=0;n<t;n++)e[ut].push(e.buildGridRowNode(n));e._renderEventsOverlay(),e[b].appendTo(e[S]),e[ut].appendTo(e[ot])},buildEventsRow:function(t,r,i){var s=this,o=s.get(A),u=0,a=e.Node.create(sn);return s.loopDates(t,r,function(f,l){if(u>l)return;var c=s.getIntersectEvents(f),h=s._getRenderableEvent(c,t,r,f),p=e.Node.create(rn),d=p.one(O);if(o<c.length&&i===o-1){var v=s.get(rt),m=e.Node.create(n.sub(Gt,{count:c.length-(o-1),labelPrefix:v[tt],labelSuffix:v[V]}));m.setData(P,c),d.append(m)}else if(h){var g=s._getEvtSplitInfo(h,f,t,r);p.attr(E,g.colspan),u+=g.colspan-1,s._syncEventNodeContainerUI(h,d,g),s._syncEventNodeUI(h,d,f);var y=String(f.getTime());s.evtRenderedStack[y].push(h)}u++,a.append(p)}),a},buildEventsTable:function(t,n){var r=this,i=r.get(A),o=s.clearTime(r._findCurrentIntervalStart()),u=String(o.getTime()).concat(t.getTime()).concat(n.getTime()),a=r.rowDataTableStack[u],f;if(!a){a=e.Node.create(Zt);var l=a.one(at),c=r.buildEventsTitleRow(a,t,n);l.append(c);for(f=0;f<i;f++){var h=r.buildEventsRow(t,n,f);l.append(h)}r.rowDataTableStack[u]=a}return a},buildEventsTitleRow:function(t,n,r){var i=this,o=i.get(Z).get(ht),u=e.Node.create(sn);return i.loopDates(n,r,function(t,n){var r=e.Node.create(rn);r.addClass(Ht).toggleClass(jt,n===0).toggleClass(It,!s.isDayOverlap(t,o)).toggleClass(Ft,!s.isDayOverlap(s.subtract(t,s.DAY,1),o)).toggleClass(Bt,!s.isDayOverlap(s.subtract(t,s.WEEK,1),o)),u.append(r.setContent(t.getDate()))}),u},buildGridRowNode:function(t){var r=this,i=r._getDisplayRowsCount(),s=100/i,o=r._getTableGridNode(t),u=e.Node.create(n.sub(Yt,{height:s,top:s*t}));return u.append(o.toggleClass(Xt,t===0)),u},flushViewCache:function(){var e=this;e.evtDateStack={},e.evtRenderedStack={},e.rowDataTableStack={}},getIntersectEvents:function(t){var n=this,r=n.get(Z),i=String(t.getTime());if(!n.evtDateStack[i]){var s=r.getIntersectEvents(t);n.evtDateStack[i]=e.Array.filter(s,n.get(B))}return n.evtDateStack[i]},getNextDate:function(){var e=this,t=e.get(Z),n=t.get(dt),r=e.get(L);return s.toLastHour(s.add(n,s.DAY,r))},getPrevDate:function(){var e=this,t=e.get(Z),n=t.get(dt),r=e.get(L);return s.toMidnight(s.subtract(n,s.DAY,r))},hideEventsOverlay:function(){var e=this;e[H].set(vt,!1)},loopDates
:function(e,t,n,r,i){var o=this,u=s.clone(e),a=t.getTime(),f;for(f=0;u.getTime()<=a;f++)n.apply(o,[u,f]),u=s.add(u,r||s.DAY,i||1)},plotEvents:function(){var e=this,t=e._findCurrentIntervalStart(),n=s.safeClearTime(t);e.flushViewCache(),e.hideEventsOverlay(),e.bodyNode.all(f+Dt).remove();var r=e.get(L),i=Math.min(r,u);e[ut].each(function(t,r){var o=s.add(n,s.DAY,i*r),u=s.add(o,s.DAY,i-1),a=e.buildEventsTable(o,u);r===0&&a.addClass(zt),t.append(a)})},syncDaysHeaderUI:function(){var e=this,t=e.get(Z),n=t.get(dt),r=e.get(R),i=e.get(X),o=e._findFirstDayOfWeek(n);e.colHeaderDaysNode.all(O).each(function(t,n){var i=s.add(o,s.DAY,n);t.html(r.call(e,i))})},syncGridUI:function(){var e=this,t=e.get(Z),n=t.get(ht);e[x].removeClass(St);var r=e._findCurrentIntervalStart(),i=e._findCurrentIntervalEnd();if(s.between(n,r,i)){var o=t.get(F),u=e._findFirstDayOfWeek(n),a=s.getWeekNumber(n,o)-s.getWeekNumber(r,o),f=n.getDate()-u.getDate(),l=e._getCellIndex([f,a]),c=e[x].item(l);c&&c.addClass(St)}},syncStdContent:function(){var e=this;e.setStdModContent(o.BODY,e[Y].getDOM()),e.setStdModContent(o.HEADER,e[U].getDOM())},_findCurrentIntervalEnd:function(){var e=this,t=e.get(Z),n=t.get(dt),r=e.get(L);return s.add(n,s.DAY,r)},_findCurrentIntervalStart:function(){var e=this,t=e.get(Z);return t.get(dt)},_findFirstDayOfWeek:function(e){var t=this,n=t.get(Z),r=n.get(F);return s.getFirstDayOfWeek(e,r)},_getCellIndex:function(e){var t=this;return e[1]*u+e[0]},_getDisplayRowsCount:function(){var e=this,t=e.get(L);return Math.ceil(t/u)},_getDisplayRowDaysCount:function(){var e=this,t=e.get(L);return Math.min(t,u)},_getEvtLabel:function(e){var t=this,n=e.get(_),r=e.get(nt);return[r.getHours(),a,n.getHours(),c,e.get(N)].join(l)},_getEvtSplitInfo:function(e,t,n,r){var i=this,o=e.getClearStartDate(),u=e.getClearEndDate(),a=s.getDayOffset(r,t),f={colspan:Math.min(s.getDayOffset(u,t),a)+1,left:s.before(o,n),right:s.after(u,r)};return f},_getRenderableEvent:function(t,n,r,i){var o=this,u=String(i.getTime()),a;o.evtRenderedStack[u]||(o.evtRenderedStack[u]=[]);for(a=0;a<t.length;a++){var f=t[a],l=f.get(nt),c=s.after(i,l)&&!s.isDayOverlap(i,n),h=!s.isDayOverlap(l,i),p=e.Array.indexOf(o.evtRenderedStack[u],f)>-1;if(!p&&(h||c))return f}return null},_getTableGridNode:function(t){var n=this,r=n.get(L),i=n[st].item(t),s=i.one(pt),o;for(o=0;o<Math.min(r,u);o++){var a=e.Node.create(Jt);s.append(a),o===0&&a.addClass(Et),n[x].push(a)}return i},_onClickMore:function(t){var n=this,r=t.target,i=r.getData(P),s=e.NodeList.create();e.Array.each(i,function(e){var t=e.get(J).item(0).clone();t.setData(et,e),t.setStyles({height:"auto",left:0,position:"relative",top:0,width:"auto"}),s.push(t)}),n[H].bodyNode.one(f+Nt).setContent(s),n[H].setAttrs({visible:!0,xy:r.getXY()})},_renderEventsOverlay:function(){var t=this,r=t.get(Z),i=t.get(rt);t[H]=new e.Overlay({align:{points:[lt,lt]},bodyContent:n.sub($t,{label:i[g]}),render:t.get(m),visible:!1,width:250,zIndex:450}),t[H].bodyNode.delegate("click",e.bind(t.hideEventsOverlay,t),f+Ct)},_syncEventNodeContainerUI:function(e,t,n){var r=this;t.addClass(qt),n.left&&t.addClass(Rt).prepend(tn),n.right&&t.addClass(Ut).append(nn)},_syncEventNodeUI:function(e,t,n){var r=this,i=r.get(Z),o=i.get(F),a=e.get(J),f=e.get(nt),l=s.clearTime(r._findCurrentIntervalStart()),c=s.getFirstDayOfWeek(new Date(Math.max(f,l)),o),h=Math.floor(s.getDayOffset(n,c)/u);a.size()<=h&&e.addPaddingNode();var p=a.item(h);p.setStyles({height:"auto",left:0,top:0,width:"auto"}),p.appendTo(t),e.syncUI()},_uiSetDate:function(e){var t=this;t.syncDaysHeaderUI(),t.syncGridUI()},_valueColHeaderDaysNode:function(){var e=this,t=e.get(L),n=Math.min(t,u);return e._valueNodeList(n,Kt)},_valueTableGridNode:function(){var e=this,t=e.get(L),n=Math.min(t,u);return e._valueNodeList(n,en)},_valueNodeList:function(t,n){var r=this,i=[];while(t--)i.push(n);return e.NodeList.create(i.join(l))}}});e.SchedulerTableView=on},"2.0.0",{requires:["overlay","aui-scheduler-base"],skinnable:!0});
