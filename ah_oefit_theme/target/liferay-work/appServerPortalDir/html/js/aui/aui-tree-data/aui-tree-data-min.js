YUI.add("aui-tree-data",function(e,t){var n=e.Lang,r=n.isArray,i=n.isBoolean,s=n.isObject,o=n.isUndefined,u="boundingBox",a="children",f="container",l=".",c="id",h="index",p="lazyLoad",d="leaf",v="nextSibling",m="node",g="ownerTree",y="parentNode",b="prevSibling",w="previousSibling",E="tree",S="tree-node",x="tree-data",T=function(t){return e.instanceOf(t,e.TreeNode)},N=function(t){return e.instanceOf(t,e.TreeView)},C=e.getClassName,k=C(E,m),L=function(){};L.ATTRS={container:{setter:e.one},children:{value:[],validator:r,setter:"_setChildren"},index:{value:{}}},e.mix(L.prototype,{_indexPrimed:!1,childrenLength:0,initializer:function(){var e=this;e.publish("move"),e.publish("append",{defaultFn:e._appendChild}),e.publish("remove",{defaultFn:e._removeChild})},destructor:function(){var e=this;e.eachChildren(function(e){e.destroy()},!0)},getNodeById:function(e){var t=this;return t._indexPrimed||t.refreshIndex(),t.get(h)[e]},isRegistered:function(e){var t=this;return!!t.get(h)[e.get(c)]},updateReferences:function(t,n,r){var i=this,s=t.get(y),o=t.get(g),u=s&&s!==n;if(s){if(u){var f=s.get(a);e.Array.removeItem(f,t),s.set(a,f)}s.unregisterNode(t)}o&&o.unregisterNode(t),t.set(y,n),t.set(g,r),n&&n.registerNode(t),r&&r.registerNode(t),o!=r&&t.eachChildren(function(e){i.updateReferences(e,e.get(y),r)});if(u){var l=i.getEventOutputMap(t);s.get(a).length||s.collapse(),l.tree.oldParent=s,l.tree.oldOwnerTree=o,i.bubbleEvent("move",l)}},refreshIndex:function(){var e=this;e.updateIndex({}),e.eachChildren(function(t){e.registerNode(t)},!0)},registerNode:function(e){var t=this,n=e.get(c),r=t.get(h);n&&(r[n]=e),N(t)&&(e.addTarget(t),e.set(g,t)),e._inheritOwnerTreeAttrs(),t.updateIndex(r)},updateIndex:function(e){var t=this;e&&(t._indexPrimed=!0,t.set(h,e))},unregisterNode:function(e){var t=this,n=t.get(h);delete n[e.get(c)],N(t)&&e.removeTarget(t),t.updateIndex(n)},collapseAll:function(){var e=this;e.eachChildren(function(e){e.collapse()},!0)},expandAll:function(){var e=this;e.eachChildren(function(e){e.expand()},!0)},selectAll:function(){var e=this;e.eachChildren(function(e){e.select()},!0)},unselectAll:function(){var e=this;e.eachChildren(function(e){e.unselect()},!0)},eachChildren:function(t,n){var r=this,i=r.getChildren(n);e.Array.each(i,function(e){e&&t.apply(r,arguments)})},eachParent:function(e){var t=this,n=t.get(y);while(n)n&&e.call(t,n),n=n.get(y)},bubbleEvent:function(e,t,n,r){var i=this;i.fire(e,t);if(!n){var s=i.get(y);t=t||{},o(r)&&(r=!0),t.stopActionPropagation=r;while(s)s.fire(e,t),s=s.get(y)}},createNode:function(t){var n=this,r=e.TreeNode.nodeTypes[s(t)?t.type:t]||e.TreeNode;return new r(s(t)?t:{})},appendChild:function(e,t){var n=this,r=n.getEventOutputMap(e);n.bubbleEvent("append",r,t)},_appendChild:function(e){if(e.stopActionPropagation)return!1;var t=this,n=e.tree.node,r=t.get(g),i=t.get(a);t.updateReferences(n,t,r);var s=i.push(n);t.childrenLength=i.length;var o=s-2,u=t.item(o);n._nextSibling=null,n._prevSibling=u,n.render(t.get(f))},item:function(e){var t=this;return t.get(a)[e]},indexOf:function(t){var n=this;return e.Array.indexOf(n.get(a),t)},hasChildNodes:function(){var e=this;return e.getChildrenLength()>0},getChildren:function(e){var t=this,n=[],r=t.get(a);return n=n.concat(r),e&&t.eachChildren(function(t){n=n.concat(t.getChildren(e))}),n},getChildrenLength:function(){var e=this;return e.childrenLength||e.get(a).length},getEventOutputMap:function(e){var t=this;return{tree:{instance:t,node:e||t}}},removeChild:function(e){var t=this,n=t.getEventOutputMap(e);t.bubbleEvent("remove",n)},_removeChild:function(t){if(t.stopActionPropagation)return!1;var n=this,r=t.tree.node,i=n.get(g);if(n.isRegistered(r)){r.set(y,null),n.unregisterNode(r),r.set(g,null),i&&i.unregisterNode(r),r.get(u).remove();var s=n.get(a);e.Array.removeItem(s,r),n.set(a,s)}},empty:function(){var e=this;e.eachChildren(function(e){var t=e.get(y);t&&t.removeChild(e)})},insert:function(e,t,n){var r=this;t=t||this;if(t===e)return!1;var i=t.get(y);if(e&&i){var s=e.get(u),o=t.get(u),f=t.get(g);n==="before"?o.placeBefore(s):n==="after"&&o.placeAfter(s);var l=[],c=i.get(u).all("> ul > li");c.each(function(e){l.push(e.getData(S))});var h=s.get(v);e.set(v,h&&h.getData(S));var p=s.get(w);e.set(b,p&&p.getData(S)),t.updateReferences(e,i,f),i.set(a,l)}e.render();var d=t.getEventOutputMap(e);d.tree.refTreeNode=t,t.bubbleEvent("insert",d)},insertAfter:function(e,t){var n=this;n.insert(e,t,"after")},insertBefore:function(e,t){var n=this;n.insert(e,t,"before")},getNodeByChild:function(e){var t=this,n=e.ancestor(l+k);return n?n.getData(S):null},_inheritOwnerTreeAttrs:n.emptyFn,_setChildren:function(t){var n=this,r=[],i=n.get(f);i||(i=n._createNodeContainer()),n.childrenLength=t.length;var o=n;T(n)&&(o=n.get(g));var u=N(o),l=!0;return u&&(l=o.get(p)),n.updateIndex({}),n.childrenLength>0&&n.set(d,!1),e.Array.each(t,function(t,f){if(t){if(!T(t)&&s(t)){var c=t[a],h=c&&c.length;t[g]=o,t[y]=n,h&&l&&delete t[a];var p=t;t=n.createNode(t),h&&l&&(p.children=c,t.childrenLength=c.length,e.setTimeout(function(){t.set(a,c)},50))}n.registerNode(t),u&&o.registerNode(t),t.render(i),e.Array.indexOf(r,t)===-1&&r.push(t)}}),r}}),e.TreeData=L},"2.0.0",{requires:["aui-base-core","aui-base-lang","aui-node-base","aui-timer","aui-component"]});
