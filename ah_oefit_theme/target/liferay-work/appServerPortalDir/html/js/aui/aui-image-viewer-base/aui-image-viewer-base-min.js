YUI.add("aui-image-viewer-base",function(e,t){var n=e.Lang,r=n.isBoolean,i=n.isNumber,s=n.isObject,o=n.isString,u=e.Plugin.NodeFX,a=e.config.doc,f="anim",l="auto",c="bd",h="blank",p="body",d="boundingBox",v="caption",m="captionEl",g="captionFromTitle",y="carousel",b="centered",w="close",E="closeEl",S="control",x="controlLeftEl",T="controlRightEl",N="createDocumentFragment",C="currentIndex",k="easeBothStrong",L="footer",A="helper",O="hidden",M="hide",_="href",D="icon",P="image",H="imageAnim",B="image-viewer",j="info",F="infoEl",I="infoTemplate",q="left",R="link",U="links",z="loader",W="loading",X="loadingEl",V="lock",$="maxHeight",J="maxWidth",K="modal",Q="offsetHeight",G="offsetWidth",Y="opacity",Z="overlay",et="preloadAllImages",tt="preloadNeighborImages",nt="px",rt="region",it="right",st="scroll",ot="show",ut="showClose",at="showControls",ft=" ",lt="src",ct="time",ht="title",pt="top",dt="totalLinks",vt="viewportRegion",mt="visible",gt="well",yt="ownerDocument",bt=function(t){return t instanceof e.NodeList},wt=function(){return Array.prototype.slice.call(arguments).join(ft)},Et=e.getClassName,St=Et(y,S),xt=Et(w),Tt=Et(A,st,V),Nt=Et(M),Ct=Et(D,ct),kt=Et(B,c),Lt=Et(B,v),At=Et(B,w),Ot=Et(B,S),Mt=Et(B,P),_t=Et(B,j),Dt=Et(B,R),Pt=Et(B,z),Ht=Et(B,W),Bt=Et(q),jt=Et(it),Ft=Et(gt),It="ESC",qt="LEFT",Rt="RIGHT",Ut={height:l,width:l},zt=a.createTextNode(""),Wt="Image {current} of {total}",Xt='<h4 class="'+Lt+'"></h4>',Vt='<button class="'+wt(At,xt)+'" type="button">\u00d7</button>',$t='<a href="#" class="'+wt(Ot,St,Bt)+'">&lsaquo;</a>',Jt='<a href="#" class="'+wt(Ot,St,jt)+'">&rsaquo;</a>',Kt='<img class="'+Mt+'" />',Qt='<h5 class="'+_t+'"></h5>',Gt='<div class="'+Pt+'"></div>',Yt='<div class="'+Ct+'"></div>',Zt=e.Base.create("aui-image-viewer",e.Widget,[e.WidgetCssClass,e.WidgetStdMod,e.WidgetToggle,e.WidgetPosition,e.WidgetStack,e.WidgetPositionAlign,e.WidgetPositionConstrain,e.WidgetModality],{_keyHandler:null,renderUI:function(){var e=this;e._renderControls(),e._renderFooter(),e.get(U).addClass(Dt)},bindUI:function(){var t=this,n=t.get(U),r=t.get(x),i=t.get(T),s=t.get(E);s.on("click",e.bind(t._onClickCloseEl,t)),r.on("click",e.bind(t._onClickLeftControl,t)),i.on("click",e.bind(t._onClickRightControl,t)),n.on("click",e.bind(t._onClickLinks,t)),t._keyHandler=e.bind(t._onKeyInteraction,t),e.getDoc().on("keydown",t._keyHandler),t.after("render",t._afterRender),t.after("loadingChange",t._afterLoadingChange),t.after("visibleChange",t._afterVisibleChange)},destructor:function(){var t=this,n=t.get(U);t.close(),n.detach("click"),n.removeClass(Dt),e.getDoc().detach("keydown",t._keyHandler),t.get(x).remove(!0),t.get(T).remove(!0),t.get(E).remove(!0),t.get(z).remove(!0)},close:function(){var e=this;e.hide()},getLink:function(e){var t=this;return t.get(U).item(e)},getCurrentLink:function(){var e=this;return e.getLink(e.get(C))},loadImage:function(t){var n=this,r=n.get(z);n.set(W,!0);var i=n._activeImagePool;if(!i){i=[];var s=n.get(P),o=s.clone(),u=s.clone(),a=e.bind(n._onLoadImage,n);o.on("load",a),u.on("load",a),i.push(o,u),n._activeImagePool=i}var f=i[0];f.removeAttribute("height"),f.removeAttribute("width"),f.setStyles(Ut),r.append(f),i.push(i.shift(f)),e.UA.webkit&&f.attr(lt,"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="),f.attr(lt,t),n.fire("request",{image:f})},hasLink:function(e){var t=this;return t.getLink(e)},hasNext:function(){var e=this;return e.hasLink(e.get(C)+1)},hasPrev:function(){var e=this;return e.hasLink(e.get(C)-1)},hideControls:function(){var e=this;e.get(x).hide(),e.get(T).hide(),e.get(E).hide()},next:function(){var e=this;e.hasNext()&&(e.set(C,e.get(C)+1),e.show())},preloadAllImages:function(){var e=this;e.get(U).each(function(t,n){e.preloadImage(n)})},preloadImage:function(e){var t=this,n=t.getLink(e);if(n){var r=n.attr(_);t._createPreloadImage(r)}},prev:function(){var e=this;e.hasPrev()&&(e.set(C,e.get(C)-1),e.show())},showLoading:function(){var e=this,t=e.get(X);e.setStdModContent(p,t),t.center(e.bodyNode)},show:function(){var e=this,t=e.getCurrentLink();t&&(Zt.superclass.show.apply(this,arguments),e.loadImage(t.attr(_)))},_clearPreloadImageFn:function(){var e=this,t=e._preloadImagePool,n;for(var r in t)n=t[r],n&&n.complete&&(t[r]=null)},_createPreloadImage:function(t){var n=this,r=n._preloadImagePool;r||(r=n._preloadImagePool={},n._clearPreloadImageTask=e.debounce(n._clearPreloadImageFn,50,n));if(!(t in r)){var i=new Image;i.onload=n._clearPreloadImageTask,i.src=t,r[t]=i}},_renderControls:function(){var t=this,n=e.one(p);n.append(t.get(x).hide()),n.append(t.get(T).hide()),n.append(t.get(E).hide())},_renderFooter:function(){var e=this,t=e.get(d),n=t.get(yt).invoke(N);n.append(e.get(m)),n.append(e.get(F)),e.setStdModContent(L,n)},_syncCaptionUI:function(){var e=this,t=e.get(v),n=e.get(m),r=e.get(g);if(r){var i=e.getCurrentLink();if(i){var s=i.attr(ht);s&&(t=i.attr(ht))}}n.html(t)},_syncControlsUI:function(){var e=this,t=e.get(d),n=e.get(x),r=e.get(T),i=e.get(E);if(e.get(mt)){if(e.get(at)){var s=t.get(vt),o=Math.floor(s.height/2)+s.top;n[e.hasPrev()?ot:M](),r[e.hasNext()?ot:M](),i.show()}}else e.hideControls()},_syncImageViewerUI:function(){var e=this;e._syncControlsUI(),e._syncCaptionUI(),e._syncInfoUI()},_syncInfoUI:function(){var e=this,t=e.get(F);t.html(e.get(I))},_getRatio:function(e,t){var n=this,r=1,i=n.get($),s=n.get(J);if(t>i||e>s){var o=t/i,u=e/s;r=Math.max(o,u)}return r},_getInfoTemplate:function(e){var t=this,r=t.get(dt),i=t.get(C)+1;return n.sub(e,{current:i,total:r})},_displayLoadedImage:function(e){var t=this;t._uiSetImageSize(e),t.setStdModContent(p,e),t.set(W,!1),t._syncImageViewerUI(),t._setAlignCenter(!0),t.fire("load",{image:e});if(t.get(tt)){var n=t.get(C);t.preloadImage(n+1),t.preloadImage(n-1)}},_afterRender:function(){var e=this,t=e.bodyNode,n=e.get(d);t.addClass(kt),n.addClass(Ft),e.get(et)&&e.preloadAllImages()},_afterLoadingChange:function(e){var t=this,n=t.get(d);e.newVal?(n.addClass(Ht),t.showLoading()):n.removeClass(Ht)},_afterVisibleChange
:function(e){var t=this;t._syncControlsUI()},_onClickCloseEl:function(e){var t=this;t.close(),e.halt()},_onClickLeftControl:function(e){var t=this;t.prev(),e.halt()},_onClickRightControl:function(e){var t=this;t.next(),e.halt()},_onClickLinks:function(e){var t=this,n=e.currentTarget;t.set(C,t.get(U).indexOf(n)),t.show(),e.preventDefault()},_onKeyInteraction:function(e){var t=this;if(!t.get(mt))return!1;e.isKey(qt)?t.prev():e.isKey(Rt)?t.next():e.isKey(It)&&t.close()},_onLoadImage:function(e){var t=this,n=e.currentTarget;t._displayLoadedImage(n);var r=t.get(H);t.get(f)&&(n.setStyle(Y,0),n.fx||n.plug(u,r),n.fx.on("end",function(e){t.fire("anim",{anim:e,image:n})}),n.fx.stop().run())},_uiSetImageSize:function(e){var t=this,n=t.bodyNode,r=t.footerNode,i=e.get(rt),s=t._getRatio(i.width,i.height),o=i.height/s,u=i.width/s;e.set(Q,o),e.set(G,u),r.setStyle("width",u+nt),n.setStyles({height:o+nt,width:u+nt})}},{NAME:B,CSS_PREFIX:Et(B),ATTRS:{anim:{value:!0,validator:r},bodyContent:{value:zt},caption:{value:h,validator:o},captionFromTitle:{value:!0,validator:r},centered:{value:!0},currentIndex:{value:0,validator:i},image:{readOnly:!0,valueFn:function(){return e.Node.create(Kt)}},imageAnim:{value:{},setter:function(t){return e.merge({to:{opacity:1},duration:.8},t)},validator:s},infoTemplate:{getter:function(e){return this._getInfoTemplate(e)},value:Wt,validator:o},links:{setter:function(t){var n=this;return bt(t)?t:o(t)?e.all(t):new e.NodeList([t])}},loading:{value:!1,validator:r},modal:{value:!0},preloadAllImages:{value:!1,validator:r},preloadNeighborImages:{value:!0,validator:r},showClose:{value:!0,validator:r},showControls:{value:!0,validator:r},tabIndex:{value:null},totalLinks:{readOnly:!0,getter:function(e){return this.get(U).size()}},visible:{value:!1},zIndex:{value:3e3,validator:i},controlLeftEl:{readOnly:!0,valueFn:function(){return e.Node.create($t)}},controlRightEl:{readOnly:!0,valueFn:function(){return e.Node.create(Jt)}},captionEl:{readOnly:!0,valueFn:function(){return e.Node.create(Xt)}},closeEl:{readOnly:!0,valueFn:function(){return e.Node.create(Vt)}},infoEl:{readOnly:!0,valueFn:function(){return e.Node.create(Qt)}},loader:{readOnly:!0,valueFn:function(){return e.Node.create(Gt).appendTo(a.body)}},loadingEl:{valueFn:function(){return e.Node.create(Yt)}},maxHeight:{value:Infinity,validator:i},maxWidth:{value:Infinity,validator:i}}});e.ImageViewer=Zt},"2.0.0",{requires:["anim","widget","widget-modality","widget-position","widget-position-align","widget-position-constrain","widget-stack","widget-stdmod","aui-event","aui-node-base","aui-widget-cssclass","aui-widget-toggle"],skinnable:!0});
