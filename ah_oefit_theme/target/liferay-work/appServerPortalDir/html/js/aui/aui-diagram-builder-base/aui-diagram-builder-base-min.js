YUI.add("aui-diagram-builder-base",function(e,t){var n=e.Lang,r=n.isArray,i=n.isBoolean,s=n.isNumber,o=n.isObject,u=n.isString,a=function(t){return e.instanceOf(t,e.ArrayList)},f=function(t){return e.instanceOf(t,e.Node)},l=function(t){return e.instanceOf(t,e.AvailableField)},c=e.Array,h="addNode",p="auto",d="availableField",v="availableFields",m="availableFieldsDragConfig",g="boundingBox",y="builder",b="cancel",w="canvas",E="clearfix",S="close",x="container",T="content",N="contentBox",C="contentContainer",k="createDocumentFragment",L="diagram",A="diagram-builder",O="draggable",M="drop",_="dropConfig",D="dropContainer",P="field",H="fields",B="fieldsContainer",j="height",F="icon",I="iconClass",q="id",R="label",U="layout",z="maxFields",W="node",X="parentNode",V="propertyList",$="rendered",J="save",K="striped",Q="settings",G="tabView",Y="tabbable",Z="table",et="tabs",tt="title",nt="toolbar",rt="toolbarContainer",it=e.getClassName,st=".",ot="#",ut=" ",at="_",ft=it(E),lt=it(L,y,w),ct=it(L,y,T,x),ht=it(L,y,M,x),pt=it(L,y,P),dt=it(L,y,P,O),vt=it(L,y,P,F),mt=it(L,y,P,R),gt=it(L,y,H,x),yt=it(L,y,et),bt=it(L,y,nt,x),wt=it(F),Et=it(U),St=it(Y),xt=it(Y,T),Tt=it(Z,K),Nt=e.Component.create({NAME:d,ATTRS:{draggable:{value:!0,validator:i},label:{validator:u},iconClass:{validator:u},id:{value:e.guid(),setter:"_setId",validator:u},node:{valueFn:function(t){var n=this;return f(t)||(t=e.Node.create(e.Lang.sub(n.FIELD_ITEM_TEMPLATE,{iconClass:n.get(I)})),t.setData(d,n)),t},validator:f,writeOnce:!0},type:{value:W,validator:u}},EXTENDS:e.Base,buildNodeId:function(e){return v+at+P+at+e},getAvailableFieldById:function(t){return e.AvailableField.getAvailableFieldByNode(ot+e.AvailableField.buildNodeId(t))},getAvailableFieldByNode:function(t){return t=e.one(t),f(t)?t.getData(d):null},prototype:{FIELD_ITEM_TEMPLATE:'<li class="'+pt+'">'+'<span class="'+[wt,vt].join(ut)+' {iconClass}"></span>'+'<div class="'+mt+'"></div>'+"</li>",initializer:function(){var e=this,t=e.get(W);e.after({draggableChange:e._afterDraggableChange,idChange:e._afterIdChange,labelChange:e._afterLabelChange}),e.labelNode=t.one(st+mt),e._uiSetDraggable(e.get(O)),e._uiSetId(e.get(q)),e._uiSetLabel(e.get(R))},_afterDraggableChange:function(e){var t=this;t._uiSetDraggable(e.newVal)},_afterIdChange:function(e){var t=this;t._uiSetId(e.newVal)},_afterLabelChange:function(e){var t=this;t._uiSetLabel(e.newVal)},_setId:function(t){return e.AvailableField.buildNodeId(t)},_uiSetDraggable:function(e){var t=this;t.get(W).toggleClass(dt,e)},_uiSetId:function(e){var t=this;t.get(W).set(q,e)},_uiSetLabel:function(e){var t=this;t.get(W).attr(tt,e),t.labelNode.setContent(e)}}});e.AvailableField=Nt;var Ct=function(){};Ct.ATTRS={fields:{value:[],setter:"_setFields",validator:function(e){return r(e)||a(e)}},maxFields:{value:Infinity,validator:s}},e.mix(Ct.prototype,{_setFields:function(e){var t=this;return a(e)?e:t.createFields(e)},_updateFields:function(e){var t=this;t.set(H,e)},addField:function(e,t){var n=this;if(n.get(H).size()<n.get(z)){var r=n.createField(e);return r&&n._updateFields(n.get(H).add(r,t)),r}return null},createFields:function(t){var n=this,r=[];return c.each(t,function(e,t){t<n.get(z)&&r.push(n.createField(e))}),new e.ArrayList(r)},removeField:function(e){var t=this;t._updateFields(t.get(H).remove(e))},createField:function(e){return e}}),e.FieldSupport=Ct;var kt=e.Component.create({NAME:A,ATTRS:{availableFields:{setter:"_setAvailableFields",validator:r},availableFieldsDragConfig:{value:null,setter:"_setAvailableFieldsDragConfig",validator:o},canvas:{valueFn:function(){return e.Node.create(this.CANVAS_TEMPLATE)}},dropConfig:{value:null,setter:"_setDropConfig",validator:o},contentContainer:{valueFn:function(){return e.Node.create(this.CONTENT_CONTAINER_TEMPLATE)}},dropContainer:{valueFn:function(){return e.Node.create(this.DROP_CONTAINER_TEMPLATE)}},fieldsContainer:{valueFn:function(){return e.Node.create(this.FIELDS_CONTAINER_TEMPLATE)}},propertyList:{setter:"_setPropertyList",validator:o,value:null},strings:{value:{addNode:"Add node",cancel:"Cancel",close:"Close",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}},tabView:{setter:"_setTabView",validator:o,value:null,writeOnce:!0},toolbar:{setter:"_setToolbar",validator:o,value:null},toolbarContainer:{valueFn:function(){return e.Node.create(this.TOOLBAR_CONTAINER_TEMPLATE)}}},HTML_PARSER:{contentContainer:st+ct,dropContainer:st+ht,fieldsContainer:st+gt,toolbarContainer:st+bt,canvas:st+lt},UI_ATTRS:[v,H],AUGMENTS:[e.FieldSupport],prototype:{CANVAS_TEMPLATE:'<div tabindex="1" class="'+lt+'"></div>',CONTENT_CONTAINER_TEMPLATE:'<div class="'+ct+'"></div>',DROP_CONTAINER_TEMPLATE:'<div class="'+ht+'"></div>',FIELDS_CONTAINER_TEMPLATE:'<ul class="'+[gt,ft].join(ut)+'"></ul>',TOOLBAR_CONTAINER_TEMPLATE:'<div class="'+bt+'"></div>',fieldsNode:null,propertyList:null,settingsNode:null,tabView:null,toolbar:null,initializer:function(){var e=this;e.publish({cancel:{defaultFn:e._defCancelFn}}),e.after({render:e._afterRender,"model:change":e._afterModelChange}),e.after(e._afterUiSetHeight,e,"_uiSetHeight"),e.canvas=e.get(w),e.contentContainer=e.get(C),e.dropContainer=e.get(D),e.fieldsContainer=e.get(B),e.toolbarContainer=e.get(rt)},isAvailableFieldsDrag:function(e){var t=this,n=t.availableFieldsDrag;return e===n.dd},plotFields:function(){var e=this,t=e.get(H);t.each(function(t){e.plotField(t)})},renderUI:function(){var e=this;e._renderTabs(),e._renderCanvas(),e._uiSetAvailableFields(e.get(v))},syncUI:function(){var e=this,t=e.get(N);e._setupDrop(),e._setupAvailableFieldsDrag(),t.addClass(Et)},_afterModelChange:function(e){var t=this;t._handleSaveEvent()},_afterRender:function(e){var t=this;t.plotFields()},_afterSelectionChange:function(e){var t=this,n=e.newVal,r;n&&(r=n.get("panelNode"),t.get($)&&r===t.settingsNode&&t._renderSettings())},_afterUiSetHeight:function(e){var t=this;t.contentContainer.setStyle(j,s(e)?e+t.DEF_UNIT:e),t.dropContainer.setStyle(j,s(e)?e+t.DEF_UNIT:e)},_defCancelFn:function(
e){var t=this;t.tabView.selectChild(0)},_handleCancelEvent:function(){var e=this;e.fire(b)},_handleSaveEvent:function(){var e=this;e.fire(J)},_renderCanvas:function(){var e=this,t=e.get(N),n=e.canvas,r=e.contentContainer,i=e.dropContainer;n.inDoc()||r.appendChild(n),i.inDoc()||n.appendChild(i),r.inDoc()?r.get(X).append(r):t.appendChild(r)},_renderPropertyList:function(){var t=this;if(!t.propertyList){var n=t.propertyList=new e.PropertyList(t.get(V));n.render(t.settingsNode),n.get(g).unselectable().addClass(Tt)}},_renderSettings:function(){var e=this;e._renderPropertyList(),e._renderToolbar()},_renderTabs:function(){var t=this;if(!t.tabView){var n=new e.TabView(t.get(G));t.tabView=n,t.fieldsNode=n.item(0).get("panelNode"),t.settingsNode=n.item(1).get("panelNode")}},_renderToolbar:function(){var t=this;t.toolbar||(t.toolbar=(new e.Toolbar(t.get(nt))).render(t.settingsNode))},_setupDrop:function(){var t=this;t.drop=new e.DD.Drop(t.get(_))},_setupAvailableFieldsDrag:function(){var t=this;t.availableFieldsDrag=new e.DD.Delegate(t.get(m))},_setAvailableFields:function(t){var n=this,r=[];return c.each(t,function(t,n){r.push(l(t)?t:new e.AvailableField(t))}),r},_setDropConfig:function(t){var n=this;return e.merge({bubbleTargets:n,groups:[v],node:n.dropContainer},t||{})},_setAvailableFieldsDragConfig:function(t){var n=this;return e.merge({bubbleTargets:n,container:n.get(g),dragConfig:{groups:[v],plugins:[{cfg:{moveOnEnd:!1},fn:e.Plugin.DDProxy}]},nodes:st+dt},t||{})},_setPropertyList:function(t){var n=this;return e.merge({bubbleTargets:n,width:260,scroll:{height:400,width:p}},t)},_setTabView:function(t){var n=this,r=n.get(g),i=r.one(st+xt);defaultValue={after:{selectionChange:e.bind(n._afterSelectionChange,n)},boundingBox:r.one(st+St),bubbleTargets:n,cssClass:yt,render:n.get(N),srcNode:i};if(!i){var s=n.getStrings();defaultValue.children=[{label:s[h]},{label:s[Q],disabled:!0}]}return e.merge(defaultValue,t)},_setToolbar:function(t){var n=this,r=n.getStrings();return e.merge({bubbleTargets:n,children:[{on:{click:e.bind(n._handleCancelEvent,n)},label:r[S]}]},t)},_uiSetAvailableFields:function(t){var n=this,r=n.fieldsNode;if(r){var i=e.getDoc().invoke(k);c.each(t,function(e){i.appendChild(e.get(W))}),r.setContent(n.fieldsContainer.setContent(i))}},_uiSetFields:function(e){var t=this;t.get($)&&t.plotFields()}}});e.DiagramBuilderBase=kt},"2.0.0",{requires:["dd","collection","aui-tabview","aui-datatable-property-list"],skinnable:!0});
