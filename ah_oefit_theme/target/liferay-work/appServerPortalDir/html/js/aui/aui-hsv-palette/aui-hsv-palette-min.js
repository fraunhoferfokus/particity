YUI.add("aui-hsv-palette",function(e,t){var n=e.Color,r=e.Widget,i=e.Lang,s=e.getClassName,o=".",u="",a="#",f="error",l="backgroundColor",c="change",h="children",p="clientHeight",d="clientWidth",v="HSV",m="contentBox",g="controls",y="data-type",b="ff0000",w="fff",E="rgb(255, 0, 0)",S="drag",x="fieldValidator",T="hexInputChange",N="hsThumbChange",C="hsvaInputChange",k="input",L="length",A="offsetHeight",O="opacity",M="railMouseDown",_="render",D="RGB",P="rgbInputChange",H="selected",B="selectedChange",j="selectedIndex",F="slideStart",I="start",q="strings",R="to",U="value",z="valueChange",W=3,X=3,V=6,$=3,J=3,K=3,Q=3,G=100,Y="255",Z=360,et=100,tt=100,nt=100,rt=0,it=0,st=0,ot=0,ut=0,at=0,ft="mousedown",lt="alpha",ct="b",ht="g",pt="hex",dt="hsv",vt="hue",mt="r",gt="rgb",yt="saturation",bt="value",wt="&#176;",Et="%",St="%",xt=".control-group.error",Tt=".control-group",Nt=".hsv-value",Ct=s("hsv-container"),kt=s("hsv-container-controls"),Lt=s("hsv-view-container"),At=s("hsv-image-backdrop"),Ot=s("hsv-view-backdrop"),Mt=s("hsv-hs-container"),_t=s("hsv-hs-thumb"),Dt=s("hsv-value-slider-container"),Pt=s("hsv-value-canvas"),Ht=s("hsv-value-thumb"),Bt=s("hsv-value-image"),jt=s("hsv-result-view"),Ft=s("hsv-label-value-container"),It=s("hsv-label-value-hsv-container"),qt=s("hsv-label-value-rgb-container"),Rt=s("hsv-label-value-hex-container"),Ut=s("hsv-label-value"),zt=s("hsv-label-value-hex"),Wt=s("hsv-label-hidden"),Xt=s("hsv-label"),Vt=s("hsv-value"),t="hsv-palette",$t=/^([a-f0-9]{6}|[a-f0-9]{3})$/i,Jt=/^([0-9]|[1-9][0-9]|100)$/,Kt=/^([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])$/,Qt=/^([0]{0,2}[1-9]|[0]?[1-9][0-9]|[12][0-9][0-9]|3[0-5][0-9]|360)$/,Gt=e.Base.create(t,e.Widget,[e.WidgetCssClass,e.WidgetToggle],{TPL_CONTAINER:'<div class="'+Ct+' {subClass}"><div>',TPL_VIEW_CONTAINER:'<div class="'+Lt+'"><div>',TPL_IMAGE_BACKDROP:'<div class="'+At+'"><div>',TPL_VIEW_BACKDROP:'<div class="'+Ot+'"><div>',TPL_HS_CONTAINER:'<div class="'+Mt+'"><div>',TPL_HS_THUMB:'<div class="'+_t+'"><div>',TPL_VALUE_SLIDER_CONTAINER:'<div class="'+Dt+'"><div>',TPL_VALUE_CANVAS:'<span class="'+Pt+'"></span>',TPL_VALUE_THUMB:'<span class="'+Ht+'"><span class="'+Bt+'"></span></span>',TPL_RESULT_VIEW:'<div class="'+jt+'"></div>',TPL_LABEL_VALUE_CONTAINER:'<div class="'+Ft+' {subClass}"></div>',TPL_OUTPUT:'<div class="control-group '+Ut+" "+zt+'">'+"<label>{label}</label>"+'<div class="controls">'+'<input class="'+Vt+'" data-type="{type}" type="text" maxlength="{maxlength}" value="{value}">'+"</div>"+"</div>",TPL_LABEL_VALUE:'<div class="control-group input-prepend input-append"><label class="add-on">{label}</label><input class="span2 '+Vt+'" data-type="{type}" type="text" maxlength="{maxlength}" value="{value}">'+'<label class="'+Xt+'">{labelUnit}</label>'+"</div>",_outputType:pt,initializer:function(){var e=this;e.onceAfter(_,e._createSliders,e),e.on(B,e._onSelectedChange,e)},bindUI:function(){var e=this;e._hsContainer.after(ft,e._afterPaletteMousedown,e),e._paletteContainer.delegate(k,e._afterInputChange,Nt,e),e._bindDD()},destructor:function(){var e=this;e._dd.destroy()},renderUI:function(){var e=this;e._renderContainer(),e.get(m).appendChild(e._paletteContainer),e._colorThumbGutter=Math.floor(e._colorThumb.get(A)/2),e._hsContainerWidth=e._hsContainer.get(d),e._hsContainerHeight=e._hsContainer.get(p)},_afterInputChange:function(e){var t=this,n,r,i;n=e.currentTarget,t._validateFieldValue(n)?(i=n.get(U),r=n.getAttribute(y),n.ancestor(Tt).removeClass(f)):n.ancestor(Tt).addClass(f),t._paletteContainer.one(xt)||t._updateViewFromInput(n)},_afterHSThumbChange:function(e,t){var i=this,s,o,u,a,f,c,h;u=i._calculateHue(e),c=i._calculateSaturation(t),h=tt-i._valueSlider.get(U),a=i._calculateRGBColor(u,c,h),f=n.toArray(a),s=n.toHex(a),o=i._getHexValue(s,f),i._resultView.setStyle(l,s),i._valueSliderContainer.setStyle(l,s),i._setFieldValue(i._outputContainer,o),i.get(g)&&(i._setFieldValue(i._hContainer,Math.round(u)),i._setFieldValue(i._sContainer,Math.round(c)),i._setFieldValue(i._rContainer,f[0]),i._setFieldValue(i._gContainer,f[1]),i._setFieldValue(i._bContainer,f[2])),i.fire(N,{x:e,y:t,hexColor:s}),i.set(H,o,{src:r.UI_SRC})},_afterPaletteMousedown:function(e){var t=this,n,r,i,s;t._updatePaletteThumbPosition([e.pageX,e.pageY]),n=t._hsContainer.getXY(),r=t._colorThumb.getXY(),i=r[0]-n[0]+t._colorThumbGutter,s=r[1]-n[1]+t._colorThumbGutter,t._afterHSThumbChange(i,s),e.target=t._colorThumb,t._dd._handleMouseDownEvent(e)},_afterPaletteDragStart:function(){var e=this;e._setHSContainerXY()},_afterPaletteThumbDrag:function(e){var t=this,n,r;n=e.pageX-t._hsContainerXY[0]+t._colorThumbGutter,r=e.pageY-t._hsContainerXY[1]+t._colorThumbGutter,t._afterHSThumbChange(n,r)},_bindDD:function(){var t=this,n;n=(new e.DD.Drag({node:t._colorThumb})).plug(e.Plugin.DDConstrained,{constrain2node:t._hsContainer,gutter:"-"+t._colorThumbGutter}),n.after(I,t._afterPaletteDragStart,t),n.after(S,t._afterPaletteThumbDrag,t),t._dd=n},_calculateRGBColor:function(e,t,n){var r=this;return r._calculateRGB(e,t,n)},_calculateHue:function(e){var t=this,n;return e<=st?n=st:e>=t._hsContainerWidth?n=Z:n=e/t._hsContainerWidth*Z,n},_calculateRGB:function(e,t,r){var s=E,o;if(e!==Z||i.toInt(t)!==et||i.toInt(r)!==tt)o="hsva("+(e===Z?Z-1:e)+", "+t+"%, "+r+"%"+")",s=n.toRGB(o);return s},_calculateRGBArray:function(e,t,r){var i=this;return n.fromArray([e,t,r],D)},_calculateSaturation:function(e){var t=this,n;return e<=ut?n=et:e>=t._hsContainerHeight?n=ut:n=et-e/t._hsContainerHeight*et,n},_calculateX:function(e){var t=this,n;return e<=st?n=st:e>=Z?n=t._hsContainerWidth:n=e/Z*t._hsContainerWidth,n},_calculateY:function(e){var t=this,n;return e<=ut?n=t._hsContainerHeight:e>=et?n=ut:n=t._hsContainerHeight/et*(et-e),n},_createSliders:function(){var e=this;e._createValueSlider()},_createValueSlider:function(){var t=this,n,r,i;n=t.get(m),r=new e.Slider({axis:"y",min:at,max:tt}),r.RAIL_TEMPLATE=t.TPL_VALUE_CANVAS,r.THUMB_TEMPLATE=t.TPL_VALUE_THUMB,r.render(t._valueSliderContainer),i=n.one
(o+Bt).get(A),r.set(L,t._valueSliderContainer.get(A)+i/2),r.on([F,M],t._setHSContainerXY,t),r.on(z,t._onValueChange,t),t._valueSlider=r},_getContainerClassName:function(){var e=this,t=u;return e.get(g)&&(t=kt),t},_getFieldValue:function(e){var t=this;return e.one(o+Vt).get(U)},_getHexValue:function(e,t){return e.substring(1)},_getHexContainerConfig:function(){var e=this;return{label:e.get(q).hex,maxlength:V,type:pt,unit:u,value:b}},_getHSVArray:function(e){var t=this;return n.toArray(e,v)},_getXYFromHueSaturation:function(e,t){var n=this,r,i;return r=n._calculateX(e),i=n._calculateY(t),[r,i]},_normalizeHexValue:function(e){var t=u;return e.indexOf(a)===0&&(e=e.substring(1)),e.length===3&&(t=w),(e+=t).toUpperCase()},_onSelectedChange:function(e){var t=this;e.src!==r.UI_SRC&&t._updateViewByHEX(e.newVal)},_onValueChange:function(e){var t=this,i,s,o,u,a,f,l,c,h,p;e.src!==r.UI_SRC&&(c=e.newVal,t._hsContainer.setStyle(O,1-c/tt),l=t._colorThumb.getXY(),h=l[0]-t._hsContainerXY[0]+t._colorThumbGutter,p=l[1]-t._hsContainerXY[1]+t._colorThumbGutter,o=t._calculateHue(h),f=t._calculateSaturation(p),c=tt-c,u=t._calculateRGBColor(o,f,c),a=n.toArray(u),i=n.toHex(u),s=t._getHexValue(i,a),t._setFieldValue(t._outputContainer,s),t.get(g)&&(t._setFieldValue(t._vContainer,c),t._setFieldValue(t._rContainer,a[0]),t._setFieldValue(t._gContainer,a[1]),t._setFieldValue(t._bContainer,a[2])),t.fire(z,{value:c,hexColor:i}),t.set(H,s,{src:r.UI_SRC}))},_renderContainer:function(){var t=this,n;n=t._getContainerClassName(),t._paletteContainer=e.Node.create(i.sub(t.TPL_CONTAINER,{subClass:n})),t._renderViewContainer()},_renderViewContainer:function(){var t=this;t._viewContainer=e.Node.create(t.TPL_VIEW_CONTAINER),t._renderViewContainerContent(),t._paletteContainer.appendChild(t._viewContainer)},_renderViewContainerContent:function(){var e=this;e._renderImageBackdrop(),e._renderHSContainer(),e._renderThumb(),e._renderValueSliderContainer(),e._renderResultBackdrop(),e._renderResultView(),e.get(g)&&e._renderFields(),e._renderHexNode()},_renderField:function(e,t){var n=this;return e.appendChild(i.sub(n.TPL_LABEL_VALUE,{classLabel:t.classLabel||u,label:t.label,labelUnit:t.unit,maxlength:t.maxlength,type:t.type,value:t.value}))},_renderOutputField:function(e,t){var n=this;return e.appendChild(i.sub(n.TPL_OUTPUT,{label:t.label,maxlength:t.maxlength,type:t.type,value:t.value}))},_renderHexNode:function(){var t=this,n,r;n=e.Node.create(i.sub(t.TPL_LABEL_VALUE_CONTAINER,{subClass:Rt})),r=t._getHexContainerConfig(),t._outputContainer=t._renderOutputField(n,r),t._viewContainer.appendChild(n),t._labelValueRGBContainer=n},_renderFields:function(){var t=this,n,r;n=e.Node.create(i.sub(t.TPL_LABEL_VALUE_CONTAINER,{subClass:It})),r=e.Node.create(i.sub(t.TPL_LABEL_VALUE_CONTAINER,{subClass:qt})),t._hContainer=t._renderField(n,{label:t.get(q).h,maxlength:$,type:vt,unit:wt,value:st}),t._sContainer=t._renderField(n,{label:t.get(q).s,maxlength:K,type:yt,unit:Et,value:et}),t._vContainer=t._renderField(n,{label:t.get(q).v,maxlength:Q,type:bt,unit:St,value:tt}),t._rContainer=t._renderField(r,{classLabel:Wt,label:t.get(q).r,maxlength:J,type:mt,unit:u,value:Y}),t._gContainer=t._renderField(r,{classLabel:Wt,label:t.get(q).g,maxlength:X,type:ht,unit:u,value:it}),t._bContainer=t._renderField(r,{classLabel:Wt,label:t.get(q).b,maxlength:W,type:ct,unit:u,value:rt}),t._viewContainer.appendChild(n),t._viewContainer.appendChild(r),t._labelValueHSVContainer=n,t._labelValueRGBContainer=r},_renderImageBackdrop:function(){var e=this;e._hsImageBackdrop=e._viewContainer.appendChild(e.TPL_IMAGE_BACKDROP)},_renderHSContainer:function(){var e=this;e._hsContainer=e._viewContainer.appendChild(e.TPL_HS_CONTAINER)},_renderValueSliderContainer:function(){var e=this;e._valueSliderContainer=e._viewContainer.appendChild(e.TPL_VALUE_SLIDER_CONTAINER)},_renderResultBackdrop:function(){var e=this;e._resultViewBackdrop=e._viewContainer.appendChild(e.TPL_VIEW_BACKDROP)},_renderResultView:function(){var e=this;e._resultView=e._viewContainer.appendChild(e.TPL_RESULT_VIEW)},_renderThumb:function(){var e=this;e._colorThumb=e._viewContainer.appendChild(e.TPL_HS_THUMB)},_setHSContainerXY:function(){var e=this;e._hsContainerXY=e._hsContainer.getXY()},_setFieldValue:function(e,t){var n=this;e.one(o+Vt).set(U,t)},_updatePaletteThumbPosition:function(e){var t=this;t._colorThumb.setXY([e[0]-t._colorThumbGutter,e[1]-t._colorThumbGutter])},_updateViewFromInput:function(e){var t=this,n;n=e.getAttribute(y),n===vt||n===yt||n===U||n===lt?t._updateViewByHSVA(e):n===mt||n===ht||n===ct?t._updateViewByRGB(e):n===pt&&t._updateViewByHEXNode(e)},_updateViewByHSVA:function(e){var t=this,i,s,o,u,a,f,c,h;o=t._getFieldValue(t._hContainer),c=t._getFieldValue(t._sContainer),h=t._getFieldValue(t._vContainer),u=t._getXYFromHueSaturation(o,c),t._colorThumb.setStyles({left:u[0],top:u[1]}),t._valueSlider.set(U,tt-h,{src:r.UI_SRC}),a=t._calculateRGBColor(o,c,h),f=n.toArray(a),i=n.toHex(a),s=t._getHexValue(i,f),t._resultView.setStyle(l,i),t._valueSliderContainer.setStyle(l,i),t._hsContainer.setStyle(O,1-(nt-h)/nt),t._setFieldValue(t._outputContainer,s),t.get(g)&&(t._setFieldValue(t._rContainer,f[0]),t._setFieldValue(t._gContainer,f[1]),t._setFieldValue(t._bContainer,f[2])),t.fire(C,{hexColor:i,node:e}),t.set(H,s,{src:r.UI_SRC})},_updateViewByRGB:function(e){var t=this,i,s,o,u,a,f,c,h,p,d,v,m,y,b;p=t._getFieldValue(t._rContainer),s=t._getFieldValue(t._gContainer),i=t._getFieldValue(t._bContainer),d=t._calculateRGBArray(p,s,i),a=n.toHSV(d),f=t._getHSVArray(a),c=f[0],y=f[1],b=f[2],v=t._calculateRGBColor(c,y,b),m=n.toArray(v),o=n.toHex(v),u=t._getHexValue(o,m),h=t._getXYFromHueSaturation(c,y),t._colorThumb.setStyles({left:h[0],top:h[1]}),t._valueSlider.set(U,tt-b,{src:r.UI_SRC}),t._resultView.setStyle(l,o),t._valueSliderContainer.setStyle(l,o),t._hsContainer.setStyle(O,1-(nt-b)/nt),t._setFieldValue(t._outputContainer,u),t.get(g)&&(t._setFieldValue(t._hContainer,c),t._setFieldValue(t._sContainer,y),t._setFieldValue(t._vContainer
,b)),t.fire(P,{hexColor:o,node:e}),t.set(H,u,{src:r.UI_SRC})},_updateViewByHEXNode:function(e){var t=this,n;n=e.get(U),t._updateViewByHEX(n),t.fire(T,{hexColor:n,fieldNode:e}),t.set(H,n,{src:r.UI_SRC})},_updateViewByHEX:function(e){var t=this,i,s,o,u,f,c,h,p,d,m,y,b,w,E;u=t._normalizeHexValue(e),u=u.substr(0,6),c=n.toHSV(u),h=n.toArray(c,v),p=h[0],w=h[1],E=h[2],y=n.toRGBA(c),b=n.toArray(y),m=b[0],o=b[1],i=b[2],d=t._getXYFromHueSaturation(h[0],h[1]),t._colorThumb.setStyles({left:d[0],top:d[1]}),t._valueSlider.set(U,tt-E,{src:r.UI_SRC}),f=a+u,t._resultView.setStyle(l,f),t._valueSliderContainer.setStyle(l,f),t._hsContainer.setStyle(O,1-(nt-E)/nt),t.get(g)&&(s=t._getFieldValue(t._outputContainer),e.toLowerCase()!==s.toLowerCase()&&t._setFieldValue(t._outputContainer,e),t._setFieldValue(t._hContainer,p),t._setFieldValue(t._sContainer,w),t._setFieldValue(t._vContainer,E),t._setFieldValue(t._rContainer,m),t._setFieldValue(t._gContainer,o),t._setFieldValue(t._bContainer,i))},_validateFieldValue:function(e){var t=this,n,r,i,s;return n=t.get(x),i=n[e.getAttribute(y)],r=!1,s=e.get(U),i&&i.test(s)&&(r=!0),r}},{CSS_PREFIX:s(t),ATTRS:{controls:{validator:i.isBoolean,value:!0,writeOnce:!0},fieldValidator:{validator:i.isObject,value:{alpha:Kt,b:Kt,g:Kt,hex:$t,hue:Qt,r:Kt,saturation:Jt,value:Jt}},selected:{validator:i.isString,value:u},strings:{value:{a:"A",b:"B",g:"G",h:"H",r:"R",hex:"Hex",s:"S",v:"V"}}},NAME:t,NS:t});e.HSVPalette=Gt},"2.0.0",{requires:["aui-classnamemanager","aui-widget-cssclass","aui-widget-toggle","aui-event-input","base-build","clickable-rail","color-hsv","dd-constrain","slider","widget"],skinnable:!0});
