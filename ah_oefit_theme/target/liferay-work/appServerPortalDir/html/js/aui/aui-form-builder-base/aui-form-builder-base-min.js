YUI.add("aui-form-builder-base",function(e,t){var n=e.Lang,r=n.isArray,i=n.isBoolean,s=n.isObject,o=n.isString,u=e.Array,a=e.AvailableField.getAvailableFieldById,f=function(t){return t instanceof e.AvailableField},l=function(t){return t instanceof e.FormBuilderField},c="allowRemoveRequiredFields",h="attributeName",p="availableField",d="availableFields",v="boundingBox",m="builder",g="data",y="dd",b="diagram",w="draggable",E="dragging",S="drop",x="",T="field",N="fields",C="fieldsSortableListConfig",k="form",L="form-builder",A="hiddenAttributes",O="id",M="label",_="localizationMap",t="name",D="node",P="opacity",H="options",B="parent",j="parentNode",F="placeholder",I="predefinedValue",q="readOnlyAttributes",R="rendered",U="required",z="selected",W="showLabel",X="tip",V="type",$="unique",J="value",K="width",Q="hover",G="zone",Y=".",Z="",et="_",tt=e.getClassName,nt=d+et+T+et,rt=N+et+T+et,it=tt(y,E),st=tt(b,m,T,w),ot=tt(k,m,T,Q),ut=tt(k,m,S,G),at=tt(k,m,T),ft=tt(k,m,F),lt='<div class="'+ft+'"></div>',ct=e.Component.create({NAME:p,ATTRS:{hiddenAttributes:{validator:r},name:{},options:{validator:s},predefinedValue:{},readOnlyAttributes:{validator:r},required:{validator:i},showLabel:{validator:i,value:!0},tip:{validator:o},unique:{validator:i},width:{}},EXTENDS:e.AvailableField});e.FormBuilderAvailableField=ct;var ht=e.Component.create({NAME:L,ATTRS:{allowRemoveRequiredFields:{validator:i,value:!1},enableEditing:{value:!0},fieldsSortableListConfig:{setter:"_setFieldsSortableListConfig",validator:s,value:null},strings:{value:{addNode:"Add field",close:"Close",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}}},UI_ATTRS:[c],EXTENDS:e.DiagramBuilderBase,FIELDS_TAB:0,SETTINGS_TAB:1,prototype:{selectedFieldsLinkedSet:null,uniqueFieldsMap:null,initializer:function(){var t=this;t.selectedFieldsLinkedSet=new e.LinkedSet({after:{add:e.bind(t._afterSelectedFieldsSetAdd,t),remove:e.bind(t._afterSelectedFieldsSetRemove,t)}}),t.uniqueFieldsMap=new e.Map({after:{put:e.bind(t._afterUniqueFieldsMapPut,t),remove:e.bind(t._afterUniqueFieldsMapRemove,t)}}),t.on({cancel:t._onCancel,"drag:end":t._onDragEnd,"drag:start":t._onDragStart,"drag:mouseDown":t._onDragMouseDown,save:t._onSave}),t.after("*:focusedChange",t._afterFieldFocusedChange),t.dropContainer.delegate("click",e.bind(t._onClickField,t),Y+at),t.dropContainer.delegate("mouseover",e.bind(t._onMouseOverField,t),Y+at),t.dropContainer.delegate("mouseout",e.bind(t._onMouseOutField,t),Y+at)},syncUI:function(){var e=this;e._setupAvailableFieldsSortableList(),e._setupFieldsSortableList()},closeEditProperties:function(){var t=this;t.tabView.selectChild(e.FormBuilder.FIELDS_TAB),t.tabView.disableTab(e.FormBuilder.SETTINGS_TAB)},createField:function(t){var n=this,r={builder:n,parent:n};return l(t)?t.setAttrs(r):(e.each(t,function(e,n){e===undefined&&delete t[n]}),t=new(n.getFieldClass(t.type||T))(e.mix(r,t))),t.addTarget(n),t},duplicateField:function(e){var t=this,n=t._getFieldNodeIndex(e.get(v)),r=t._cloneField(e,!0),i=r.get(v);i.setStyle(P,0),t.insertField(r,++n,e.get(B)),i.show(!0)},editField:function(e){var t=this;l(e)&&(t.editingField=e,t.unselectFields(),t.selectFields(e))},getFieldClass:function(t){var n=e.FormBuilder.types[t];return n?n:(e.log("The field type: ["+t+"] couldn't be found."),null)},getFieldProperties:function(e,t){return e.getProperties(t)},insertField:function(e,t,n){var r=this;n=n||r,e.get(B).removeField(e),n.addField(e,t)},openEditProperties:function(t){var n=this;n.tabView.enableTab(e.FormBuilder.SETTINGS_TAB),n.tabView.selectChild(e.FormBuilder.SETTINGS_TAB),n.propertyList.set(g,n.getFieldProperties(t,!0))},plotField:function(e,t){var n=this,r=e.get(v);e.get(R)?t.append(r):e.render(t),n._syncUniqueField(e),n.fieldsSortableList.add(r)},plotFields:function(t,n){var r=this;n=n||r.dropContainer,t=t||r.get(N),n.setContent(x),e.each(t,function(e){r.plotField(e,n)})},selectFields:function(e){var t=this,n=t.selectedFieldsLinkedSet;u.each(u(e),function(e){n.add(e)})},simulateFocusField:function(e){var t=this,n=t.lastFocusedField;n&&n.blur(),t.lastFocusedField=e.focus()},unselectFields:function(e){var t=this,n=t.selectedFieldsLinkedSet;e||(e=n.values()),u.each(u(e),function(e){n.remove(e)})},_afterFieldFocusedChange:function(e){var t=this,n=e.target;e.newVal&&l(n)&&t.editField(n)},_afterUniqueFieldsMapPut:function(e){var t=a(e.key),n;f(t)&&(n=t.get(D),t.set(w,!1),n.unselectable())},_afterUniqueFieldsMapRemove:function(e){var t=a(e.key),n;f(t)&&(n=t.get(D),t.set(w,!0),n.selectable())},_afterSelectedFieldsSetAdd:function(e){var t=this;e.value.set(z,!0),t.openEditProperties(e.value)},_afterSelectedFieldsSetRemove:function(e){var t=this;e.value.set(z,!1),t.closeEditProperties()},_cloneField:function(t,n){var r=this,i=t.getAttributesForCloning();return n&&(i[N]=[],e.each(t.get(N),function(e,t){e.get($)||(i[N][t]=r._cloneField(e,n))})),r.createField(i)},_dropField:function(n){var r=this,i=n.getData(p),s=e.Widget.getByNode(n);if(f(i)){var o={hiddenAttributes:i.get(A),label:i.get(M),localizationMap:i.get(_),options:i.get(H),predefinedValue:i.get(I),readOnlyAttributes:i.get(q),required:i.get(U),showLabel:i.get(W),tip:i.get(X),type:i.get(V),unique:i.get($),width:i.get(K)};o.unique&&(o.id=r._getFieldId(i),o.name=i.get(t)),s=r.createField(o)}if(l(s)){var u=n.get(j),a=e.Widget.getByNode(u),c=r._getFieldNodeIndex(n);l(a)||(a=r),r.insertField(s,c,a)}},_getFieldId:function(e){var t=e.get(O),n;return f(e)?n=nt:n=rt,t.replace(n,Z)},_getFieldNodeIndex:function(e){return e.get(j).all("> *:not("+Y+ft+")").indexOf(e)},_onCancel:function(e){var t=this;t.unselectFields(),e.halt()},_onDragEnd:function(t){var n=this,r=t.target,i=r.get(D);n._dropField(i),l(e.Widget.getByNode(i))||(i.remove(),r.set(D,n._originalDragNode))},_onClickField:function(t){var n=this,r=e.Widget.getByNode(t.target);n.simulateFocusField(r),t.stopPropagation()},_onDragMouseDown:function(t){var n=t.target.get(D),r=e.AvailableField.getAvailableFieldByNode(n);f(r)&&!r.get(w)&&t.halt()},
_onDragStart:function(t){var n=this,r=t.target,i=r.get(D);if(l(e.Widget.getByNode(i)))return;n._originalDragNode=i;var s=i.clone();i.placeBefore(s),r.set(D,s);var o=i.getData(p);s.setData(p,o),s.attr(O,x),s.hide(),i.removeClass(it),i.show(),n.fieldsSortableList.add(s)},_onMouseOutField:function(t){var n=e.Widget.getByNode(t.currentTarget);n.controlsToolbar.hide(),n.get(v).removeClass(ot),t.stopPropagation()},_onMouseOverField:function(t){var n=e.Widget.getByNode(t.currentTarget);n.controlsToolbar.show(),n.get(v).addClass(ot),t.stopPropagation()},_onSave:function(){var e=this,t=e.editingField;if(t){var n=e.propertyList.get(g);n.each(function(e){t.set(e.get(h),e.get(J))}),e._syncUniqueField(t)}},_setAvailableFields:function(t){var n=[];return u.each(t,function(t){n.push(f(t)?t:new e.FormBuilderAvailableField(t))}),n},_setFieldsSortableListConfig:function(t){var n=this,r=n.dropContainer;return e.merge({bubbleTargets:n,dd:{groups:[d],plugins:[{cfg:{horizontal:!1,scrollDelay:150},fn:e.Plugin.DDWinScroll}]},dropCondition:function(t){var n=t.drop.get(D),r=e.Widget.getByNode(n);return l(r)?!0:!1},placeholder:e.Node.create(lt),dropOn:Y+ut,sortCondition:function(e){var t=e.drop.get(D);return t!==n.dropContainer&&r.contains(t)}},t||{})},_setupAvailableFieldsSortableList:function(){var t=this;if(!t.availableFieldsSortableList){var n=t.fieldsContainer.all(Y+st);t.availableFieldsSortableList=new e.SortableList(e.merge(t.get(C),{nodes:n}))}},_setupFieldsSortableList:function(){var t=this;t.fieldsSortableList||(t.fieldsSortableList=new e.SortableList(t.get(C)))},_syncUniqueField:function(e){var t=this,n=t._getFieldId(e),r=a(n);f(r)&&(r.get($)||e.get($))&&t.uniqueFieldsMap.put(n,e)},_uiSetAllowRemoveRequiredFields:function(){var e=this;e.get(N).each(function(e){e._uiSetRequired(e.get(U))})}}});e.FormBuilder=ht,e.FormBuilder.types={}},"2.0.0",{requires:["escape","transition","aui-button","aui-collection","aui-diagram-builder-base","aui-sortable-list","aui-tabview"],skinnable:!0});
